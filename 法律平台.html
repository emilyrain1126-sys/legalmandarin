<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³•å¾‹è¯èªå­¸ç¿’åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f8fafc;
            color: #1e293b;
            font-family: "Source Sans Pro", "Noto Sans TC", sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow-y: auto; 
            min-height: 100vh;
        }

        /* å´é‚Šæ¬„è¨­è¨ˆ */
        .sidebar {
            background-color: #f1f5f9;
            border-right: 1px solid #e2e8f0;
            width: 22%; 
            min-width: 280px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 1.5rem 1.25rem;
            z-index: 100;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .sidebar::-webkit-scrollbar { width: 4px; }
        .sidebar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        /* ä¸»å€åŸŸä½ˆå±€ */
        .main-content { 
            margin-left: clamp(280px, 22%, 340px); 
            padding: 0 2.5rem 3rem 2.5rem; 
            max-width: 1400px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* ç½®é ‚ Header */
        .sticky-header {
            position: sticky;
            top: 0;
            background-color: #f8fafc;
            padding: 1.25rem 0;
            z-index: 50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sticky-header.scrolled {
            border-bottom: 2px solid #e2e8f0;
            background-color: rgba(248, 250, 252, 0.95);
            backdrop-filter: blur(10px);
        }

        @media (max-width: 767px) {
            .sidebar { width: 100%; position: sticky; top: 0; height: auto; border-bottom: 2px solid #e2e8f0; }
            .main-content { margin-left: 0; padding: 1rem; }
            .sticky-header { position: relative; top: 0; }
        }
        
        .sub-title { 
            font-size: 1.4rem; 
            font-weight: 900; 
            color: #0f172a;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        .intro-quote {
            background-color: #eff6ff;
            color: #1d4ed8;
            padding: 1.25rem 1.5rem;
            border-radius: 1rem;
            font-size: 1.4rem;
            font-weight: 900;
            margin-bottom: 1.5rem;
            border-left: 8px solid #3b82f6;
            line-height: 1.4;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1);
        }

        .content-text { 
            font-size: 1.15rem; 
            font-weight: 800; 
            line-height: 1.8; 
            white-space: pre-wrap; 
        }

        /* æœå°‹æ¨£å¼ */
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            font-weight: 800;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.2s;
        }
        .search-input:focus { border-color: #3b82f6; }
        
        .search-results {
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 2px solid #e2e8f0;
            border-top: none;
            border-radius: 0 0 0.75rem 0.75rem;
            display: none;
            z-index: 110;
        }
        .search-item {
            padding: 0.6rem 1rem;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 800;
            border-bottom: 1px solid #f1f5f9;
        }
        .search-item:hover { background-color: #eff6ff; }

        /* å¡ç‰‡è¨­è¨ˆ */
        .card { 
            background: white; border-radius: 1rem; border: 1px solid #e2e8f0; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02); padding: 2.25rem;
            display: flex;
            flex-direction: column;
            min-height: 280px; 
        }
        .law-box { border-top: 8px solid #3b82f6; }
        .white-box { border-top: 8px solid #10b981; }

        .section-teaching { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 1.5rem; 
        }

        /* æ‡²ç½°æ¨™ç±¤ */
        .penalty-card-box { 
            border-top: 10px solid #f59e0b; 
            background: linear-gradient(to bottom, #fff, #fffbf0);
            padding: 1.5rem 2rem !important;
            min-height: auto;
        }
        .penalty-container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            width: 100%;
        }
        .penalty-tag { 
            border-radius: 1.25rem; 
            padding: 1.25rem 2rem; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center;
            text-align: center;
            flex: 1;
            min-width: 280px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
            border: 2px solid transparent;
            transition: transform 0.2s;
        }
        .tag-money { background-color: #fefce8; color: #854d0e; border-color: #fde047; }
        .tag-jail { background-color: #fef2f2; color: #991b1b; border-color: #fecaca; }
        .tag-license { background-color: #eff6ff; color: #1e40af; border-color: #bfdbfe; }

        /* æŒ‰éˆ•èˆ‡åŠŸèƒ½ */
        .btn-quiz-mini { 
            background-color: #ef4444; color: white; padding: 0.6rem 1.5rem; 
            border-radius: 9999px; font-weight: 900; font-size: 1.1rem;
            cursor: pointer; display: flex; align-items: center; gap: 0.5rem;
            transition: all 0.2s;
        }
        .btn-quiz-mini:hover { transform: scale(1.05); background-color: #dc2626; }

        #level-badge { 
            cursor: pointer; font-weight: 900; 
            padding: 0.6rem 1.5rem; border-radius: 9999px; font-size: 1.1rem;
            display: flex; align-items: center; gap: 0.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.2s;
        }
        .badge-b1-b2 { background-color: #3b82f6 !important; color: white !important; }
        .badge-c1-c2 { background-color: #8b5cf6 !important; color: white !important; }

        .glossary-word {
			text-decoration: underline; 
			text-underline-offset: 4px;
			text-decoration-style: dashed; 
			cursor: pointer; 
			font-weight: 900;
			transition: opacity 0.2s;
		}
		.glossary-word:hover { opacity: 0.7; }

		/* å®šç¾©å››ç¨®äº¤æ›¿é¡è‰² */
		.word-color-0 { color: #2563eb; } /* è— */
		.word-color-1 { color: #7c3aed; } /* ç´« */
		.word-color-2 { color: #0891b2; } /* é’ */
		.word-color-3 { color: #db2777; } /* ç²‰ */

        /* å´é‚Šæ¬„åº•éƒ¨ */
        .sidebar-footer {
            margin-top: auto;
            padding-top: 1.5rem;
            border-top: 2px solid #e2e8f0;
        }
        .btn-footer {
            width: 100%;
            padding: 0.7rem;
            border-radius: 0.85rem;
            font-weight: 900;
            font-size: 0.9rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn-log { background-color: #475569; color: white; }
        .btn-glossary { background-color: #3b82f6; color: white; }
        .btn-info { background-color: #0f172a; color: white; }

        .contact-info {
            font-size: 0.75rem;
            font-weight: 800;
            color: #64748b;
            line-height: 1.6;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            margin-top: 0.5rem;
        }

        /* è©å½™åº«ç¨ç«‹é é¢ */
        .glossary-row {
            display: grid;
            grid-template-columns: 220px 150px 1fr;
            gap: 1.5rem;
            background: white;
            padding: 1.75rem 2.25rem;
            border-radius: 1.25rem;
            border: 1px solid #e2e8f0;
            margin-bottom: 1.25rem;
            align-items: center;
            transition: all 0.2s;
        }
        .glossary-row:hover { border-color: #3b82f6; transform: translateX(5px); box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1); }
        .glossary-term-col { display: flex; flex-direction: column; }
        .glossary-def-col { font-weight: 800; color: #475569; line-height: 1.7; font-size: 1.1rem; }

        input[type="radio"] { display: none; }
        .option-label {
            cursor: pointer; padding: 1.25rem 2.25rem; border: 3px solid #e2e8f0; 
            border-radius: 1.25rem; transition: all 0.2s; display: block; 
            font-size: 1.25rem; font-weight: 900; margin-bottom: 0.85rem;
        }
        .option-label.selected-correct { background-color: #dcfce7; border-color: #10b981; color: #166534; }
        .option-label.selected-wrong { background-color: #fee2e2; border-color: #ef4444; color: #991b1b; }
    </style>
</head>
<body>

<canvas id="confetti-canvas" style="position:fixed; top:0; left:0; pointer-events:none; z-index:2000;"></canvas>

<!-- è©å½™å–®å€‹è§£é‡‹å½ˆçª— -->
<div id="term-modal-overlay" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[1100]" onclick="closeTermModal()">
    <div class="bg-white p-10 rounded-[2.5rem] max-w-md w-[90%] shadow-2xl" onclick="event.stopPropagation()">
        <div class="flex justify-between items-start mb-6">
            <div>
                <h3 id="modal-term" class="text-3xl font-black text-blue-900">è©å½™è§£é‡‹</h3>
                <p id="modal-pinyin" class="text-sm text-slate-400 font-black tracking-widest uppercase mt-1">Pinyin</p>
                <div id="modal-en" class="text-[11px] font-black text-blue-700 italic mt-4 bg-blue-50 px-4 py-2 rounded-full w-fit border border-blue-100">English Context</div>
            </div>
            <button onclick="closeTermModal()" class="text-slate-300 hover:text-slate-600 text-4xl font-black">âœ•</button>
        </div>
        <div class="bg-slate-50 p-8 rounded-3xl border-2 border-slate-100 shadow-inner">
            <p id="modal-def" class="text-slate-700 text-lg font-black leading-relaxed"></p>
        </div>
    </div>
</div>

<!-- æ¸¬é©—å½ˆçª— -->
<div id="quiz-modal-overlay" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[1100]" onclick="closeQuizModal()">
    <div class="bg-white p-12 rounded-[3rem] max-w-3xl w-[95%] shadow-2xl border-t-[14px] border-red-500" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center mb-10">
            <h3 class="text-3xl font-black text-slate-800 flex items-center gap-4"><span>ğŸ“</span> è©¦è©¦çœ‹ï¼</h3>
            <button onclick="closeQuizModal()" class="text-slate-300 hover:text-slate-600 text-4xl font-black">âœ•</button>
        </div>
        <div class="bg-slate-50 p-10 rounded-[2.5rem] mb-4 border-2 border-slate-100 shadow-inner overflow-y-auto max-h-[60vh]">
            <p id="quiz-question" class="text-2xl font-black text-slate-700 mb-10 leading-tight"></p>
            <div id="options-container" class="grid grid-cols-1 gap-4"></div>
            <div id="feedback-box" class="mt-8 p-8 rounded-3xl hidden font-black text-xl text-center shadow-xl"></div>
        </div>
    </div>
</div>

<!-- æ›´æ–°æ—¥èªŒå½ˆçª— -->
<div id="log-modal-overlay" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[1100]" onclick="closeLogModal()">
    <div class="bg-white p-12 rounded-[3rem] max-w-2xl w-[90%] shadow-2xl border-t-[12px] border-slate-600" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center mb-8">
            <h3 class="text-3xl font-black text-slate-800 flex items-center gap-4"><span>ğŸ“œ</span> ç³»çµ±æ›´æ–°æ—¥èªŒ (Log)</h3>
            <button onclick="closeLogModal()" class="text-slate-300 hover:text-slate-600 text-4xl font-black">âœ•</button>
        </div>
        <div class="bg-slate-50 p-10 rounded-[2.5rem] border shadow-inner max-h-[55vh] overflow-y-auto">
            <div class="space-y-10 text-sm font-bold text-slate-700">
                <div class="border-l-4 border-blue-500 pl-6">
                    <p class="text-blue-600 font-black text-lg mb-2">2026/01/07 (V0.d - Latest)</p>
                    <ul class="list-disc space-y-2 text-base">
                        <li>1. æ›´æ”¹äº†æ³•æ¢åŸæ–‡åŠè§£é‡‹å…§å­—å…¸åŠŸèƒ½çš„å‘ˆç¾æ–¹å¼ï¼Œå…·é«”è®Šæ›´å¦‚ä¸‹ï¼š</li>
						<li>(1) è©å½™å°‡ä¾é †åºè¦å¾‹è®Šæ›é¡è‰²ï¼Œä»¥åˆ©è¾¨è­˜</li>
						<li>(2) åƒ…åœ¨è©å½™é¦–æ¬¡å‡ºç¾æ™‚æ·»åŠ å­—å…¸åŠŸèƒ½</li>
						<li>2. æ–°å¢ã€ŒåŠŸèƒ½ã€ç­‰8å€‹è©å½™è§£é‡‹</li>
                    </ul>
                </div>
                <div class="border-l-4 border-emerald-500 pl-6">
                    <p class="text-emerald-600 font-black text-lg mb-2">2026/01/06 (V0.b)</p>
                    <ul class="list-disc space-y-2 text-base">
                        <li>1. æ–°å¢ã€Œå±…ç•™è­‰ã€ç­‰6å€‹è©å½™è§£é‡‹</li>
                        <li>2. æ–°å¢ã€Œå…¥å‡ºåœ‹åŠç§»æ°‘æ³• #22ã€ç­‰å…±1æ¢èªªæ˜</li>
                    </ul>
                </div>
				<div class="border-l-4 border-amber-500 pl-6">
                    <p class="text-amber-600 font-black text-lg mb-2">2026/01/06 (V0.a)</p>
                    <ul class="list-disc space-y-2 text-base">
                        <li>1. æ–°å¢æŸ¥è©¢åŠŸèƒ½</li>
                        <li>2. æ›´æ”¹ç­”é¡Œåé¥‹ä¸¦æ–°å¢èªªæ˜</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ç¶²ç«™è³‡è¨Šèˆ‡ç‰ˆæ¬Šå½ˆçª—-->
<div id="info-modal-overlay" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[1100]" onclick="closeInfoModal()">
    <div class="bg-white p-12 rounded-[3rem] max-w-2xl w-[90%] shadow-2xl border-t-[12px] border-blue-900" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center mb-8">
            <h3 class="text-2xl font-black text-blue-900 flex items-center gap-4"><span>â„¹ï¸</span> ç¶²ç«™è³‡è¨Šèˆ‡ç‰ˆæ¬Šè²æ˜</h3>
            <button onclick="closeInfoModal()" class="text-slate-300 hover:text-slate-600 text-4xl font-black">âœ•</button>
        </div>
        <div class="bg-slate-50 p-10 rounded-[2.5rem] border shadow-inner max-h-[55vh] overflow-y-auto">
            <div class="space-y-10 text-base font-bold text-slate-700">
                <section>
                    <h4 class="text-xl font-black text-slate-800 mb-4 border-l-6 border-blue-500 pl-4 uppercase tracking-tighter">ğŸ“œ ç¶²ç«™è³‡è¨Š</h4>
                    <p class="leading-relaxed">
                        æœ¬ç«™å‰µç«‹æ–¼ 2026 å¹´ï¼Œæ—¨åœ¨é€éå°‡å°ˆæ¥­è¡“èªä¾æŒ‡å®šç­‰ç´šé€²è¡Œç¿»è­¯ï¼Œå”åŠ©å¤–ç±äººå£«é€éç†è§£æˆ‘åœ‹æ³•å¾‹ã€‚</br>
						æœ¬ç«™åƒ…äºŒäººå…±åŒé–‹ç™¼ï¼Œæ›´æ–°é »ç‡ç´„ç‚ºæ¯æœˆ3æ¬¡ä¸å®šæ™‚æ›´æ–°ï¼Œä¸”åƒ…æ›´æ–°èˆ‡å¤–ç±äººå£«ç›¸é—œä¹‹æ³•æ¢èªªæ˜ã€‚å¦‚æœ‰é‡å°ç‰¹å®šæ³•æ¢çš„è£½ä½œéœ€æ±‚ï¼Œè«‹ä¾†ä¿¡å‘ŠçŸ¥ã€‚
                    </p>
                </section>
                <section>
                    <h4 class="text-xl font-black text-slate-800 mb-4 border-l-6 border-blue-500 pl-4 uppercase tracking-tighter">âš–ï¸ ç‰ˆæ¬Šè²æ˜</h4>
                    <p class="leading-relaxed mb-4">
                        æœ¬ç«™æ³•æ¢åŸæ–‡å¼•è‡ªå…¨åœ‹æ³•è¦è³‡æ–™åº«ã€‚ç™½è©±è§£é‡‹ã€å¼•è¨€ã€é¡Œç›®ä¹‹è‘—ä½œæ¬Šæ­¸é–‹ç™¼å°çµ„æ‰€æœ‰ã€‚</br>
						æœ¬ç«™æ‰€æœ‰å…§å®¹å¯ä¾›æ­£å¸¸æŸ¥è©¢ã€åˆ†äº«åŠæ•™å­¸ä½¿ç”¨ï¼Œç„¶ç¦æ­¢é€²è¡Œè²©å”®ç­‰é‡‘éŒ¢ç›¸é—œäº¤æ˜“è¡Œç‚ºã€‚
                    </p>
                    <div class="bg-red-50 p-6 rounded-3xl border-2 border-red-100 text-red-900 font-black">
                        âš ï¸ å…§å®¹åƒ…ä¾›è¯èªå­¸ç¿’åƒè€ƒã€‚å…·é«”æ³•å¾‹ç–‘æ…®è«‹è«®è©¢å¾‹å¸«ã€‚
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>

<!-- ç­‰ç´šé¸æ“‡å½ˆçª— -->
<div id="level-modal-overlay" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[1100]" onclick="closeLevelModal()">
    <div class="bg-white p-12 rounded-[3rem] max-w-sm w-[90%] shadow-2xl text-center" onclick="event.stopPropagation()">
        <h3 class="text-2xl font-black text-slate-800 mb-8 tracking-tight">æ›´æ›å­¸ç¿’ç¨‹åº¦ (Level)</h3>
        <div class="space-y-4">
            <div class="p-5 border-4 border-blue-500 bg-blue-50 rounded-2xl cursor-pointer flex items-center gap-4 transition-transform hover:scale-105" onclick="changeLevel('B1-B2')">
                <div class="w-5 h-5 rounded-full bg-blue-500"></div>
                <span class="font-black text-blue-800 text-lg">B1-B2 ä¸­ç´š</span>
            </div>
            <div class="p-5 border-4 border-purple-500 bg-purple-50 rounded-2xl cursor-pointer flex items-center gap-4 transition-transform hover:scale-105" onclick="changeLevel('C1-C2')">
                <div class="w-5 h-5 rounded-full bg-purple-500"></div>
                <span class="font-black text-purple-800 text-lg">C1-C2 é«˜ç´š</span>
            </div>
        </div>
    </div>
</div>

<!-- å´é‚Šæ¬„ -->
<div class="sidebar shadow-2xl">
    <h2 class="text-2xl font-black text-slate-800 mb-6 tracking-tighter border-b-4 border-blue-100 pb-4 uppercase">ğŸ“š æ³•å¾‹å­¸ç¿’å°èˆª</h2>
    
    <div class="space-y-8 flex-1">
        <div>
            <label class="text-[14px] font-black text-slate-500 block mb-3 uppercase tracking-wider">ğŸ” å–®å…ƒæœå°‹ (Search Law)</label>
            <input type="text" id="article-search" class="search-input" placeholder="æœå°‹ç”Ÿæ´»æƒ…å¢ƒ..." oninput="handleSearch()">
            <div id="search-results-list" class="search-results shadow-lg"></div>
        </div>

        <div>
            <label class="text-[14px] font-black text-slate-500 block mb-3 uppercase tracking-wider">1. æ³•å…¸é¸æ“‡ (Choose Law)</label>
            <select id="law-category-selector" class="w-full p-4 border-2 border-slate-300 rounded-2xl text-sm font-black bg-white outline-none focus:border-blue-500 shadow-sm" onchange="onCategoryChange()"></select>
        </div>
        <div>
            <label class="text-[14px] font-black text-slate-500 block mb-3 uppercase tracking-wider">2. æ¢æ–‡é¸æ“‡ (Select Article)</label>
            <select id="article-selector" class="w-full p-4 border-2 border-slate-300 rounded-2xl text-sm font-black bg-white outline-none focus:border-blue-500 shadow-sm" onchange="updateContent()"></select>
        </div>
    </div>

    <div class="sidebar-footer">
        <div class="btn-footer btn-glossary" onclick="switchView('glossary')">ğŸ“š å®Œæ•´è©å½™åº« (Glossary)</div>
        <div class="btn-footer btn-log" onclick="openLogModal()">ğŸ“œ æ›´æ–°æ—¥èªŒ (Log)</div>
        <div class="btn-footer btn-info" onclick="openInfoModal()">â„¹ï¸ ç¶²ç«™è³‡è¨Šèˆ‡ç‰ˆæ¬Šè²æ˜</div>
        <div class="contact-info text-center font-black">
            ğŸ“ éŒ¯èª¤å›å ±ï¼šguowenjiaocai@gmail.com
        </div>
    </div>
</div>

<!-- å­¸ç¿’ä¸»ç•«é¢ -->
<div id="view-study" class="main-content">
    <div class="sticky-header" id="main-header">
        <h1 class="text-3xl font-black text-slate-800 tracking-tight">ğŸ“– æ³•æ¢å­¸ç¿’</h1>
        <div class="flex items-center gap-4">
            <div class="btn-quiz-mini" onclick="openQuizModal()"><span>ğŸ“</span> challenge</div>
            <div id="level-badge" onclick="openLevelModal()" class="badge-b1-b2 shadow-lg">
                <span id="badge-text">ç­‰ç´šï¼šB1-B2</span><span>â–¼</span>
            </div>
        </div>
    </div>
    <div id="intro-box" class="intro-quote">ğŸ’¡ ç”Ÿæ´»æå•è¼‰å…¥ä¸­...</div>
    <div class="section-teaching">
        <div class="card law-box">
            <h3 class="sub-title italic text-blue-700">ğŸ“œ æ³•å¾‹æ¢æ–‡åŸæ–‡ (Original)</h3>
            <p id="law-original" class="content-text text-slate-600 font-bold"></p>
        </div>
        <div class="card white-box">
            <h3 class="sub-title italic text-emerald-700">ğŸ’¡ æ³•æ¢èªªæ˜ (Explanation)</h3>
            <p id="law-simplified" class="content-text font-black text-slate-900"></p>
        </div>
    </div>
    <div class="section-penalty">
        <div class="card penalty-card-box">
            <div id="penalty-grid" class="penalty-container"></div>
        </div>
    </div>
</div>

<!-- è©å½™åº«ç¨ç«‹é é¢ -->
<div id="view-glossary" class="main-content hidden">
    <div class="sticky-header border-b-2 pb-6 mb-8">
        <div>
            <h1 class="text-4xl font-black text-slate-800 tracking-tight">ğŸ“– è©å½™åº« (Glossary)</h1>
            <p class="text-slate-500 font-bold mt-1 text-lg">å°ˆæ¥­è¡“èªè§£é‡‹</p>
        </div>
        <button class="btn-quiz-mini bg-blue-600 border-none px-10 py-4" onclick="switchView('study')">â¬… è¿”å›å­¸ç¿’</button>
    </div>
    <div class="mb-10">
        <label class="text-[16px] font-black text-slate-500 block mb-3 uppercase tracking-wider">ğŸ” æœå°‹è¾­åº« (Search Terms)</label>
        <input type="text" id="glossary-search" class="search-input py-6 text-2xl border-4" placeholder="è¼¸å…¥é—œéµå­—..." oninput="handleGlossarySearch()">
    </div>
    <div id="glossary-table-content" class="pb-20"></div>
</div>

<script>
    let currentLevel = "B1-B2";

    // è¾­åº«æ’ç‰ˆï¼šä¸€å±¬æ€§ä¸€åˆ†è¡Œ
    const globalGlossary = {
        "ç”³è«‹": { 
            pinyin: "shÄ“nqÇng", 
            en: "apply", 
            def: "å‘æ”¿åºœæˆ–æ©Ÿæ§‹æ­£å¼æå‡ºè¦æ±‚ã€‚" 
        },
        "å±…ç•™è­‰": { 
            pinyin: "jÅ«liÃº zhÃ¨ng", 
            en: "residence permit", 
            def: "è®“å¤–åœ‹äººå¯ä»¥åœ¨å°ç£åˆæ³•ä½ä¸€æ®µæ™‚é–“çš„è­‰ä»¶ã€‚" 
        },
        "å¤–åƒ‘": { 
            pinyin: "wÃ iqiÃ¡o", 
            en: "foreign national", 
            def: "ä½åœ¨å°ç£çš„å¤–åœ‹äººã€‚" 
        },
        "ç°½è­‰": { 
            pinyin: "qiÄnzhÃ¨ng", 
            en: "visa", 
            def: "é€²å…¥ä¸€å€‹åœ‹å®¶å‰éœ€è¦çš„è¨±å¯æ–‡ä»¶ã€‚" 
        },
        "å…¥å¢ƒ": { 
            pinyin: "rÃ¹jÃ¬ng", 
            en: "entry into a country", 
            def: "é€²å…¥ä¸€å€‹åœ‹å®¶ã€‚" 
        },
        "åˆæ³•": { 
            pinyin: "hÃ©fÇ", 
            en: "legal", 
            def: "äº‹æƒ…ç¬¦åˆè¦å®šï¼Œæ˜¯å¯ä»¥åšçš„ã€‚" 
        },
        "è³‡æ ¼": { 
            pinyin: "zÄ«gÃ©", 
            en: "qualification / eligibility", 
            def: "ä¸€å€‹äººæœ‰æ²’æœ‰æ¬Šåˆ©åšæŸä»¶äº‹ã€‚" 
        },
        "ç§»æ°‘ç½²": { 
            pinyin: "yÃ­mÃ­n shÇ”", 
            en: "National Immigration Agency", 
            def: "æ”¿åºœç®¡ç†å¤–åœ‹äººå…¥å¢ƒã€å±…ç•™çš„å–®ä½ã€‚" 
        },
        "è­‰ä»¶": { 
            pinyin: "zhÃ¨ngjiÃ n", 
            en: "official document / ID", 
            def: "å¯ä»¥è­‰æ˜èº«åˆ†æˆ–è³‡æ ¼çš„æ–‡ä»¶ã€‚" 
        },
        "é›‡ä¸»": { 
            pinyin: "gÃ¹ zhÇ”", 
            en: "Employer", 
            def: "è˜è«‹å“¡å·¥å·¥ä½œä¸¦ç™¼è–ªæ°´çš„è€é—†ã€‚" 
        },
        "éå¤±": { 
            pinyin: "guÃ² shÄ«", 
            en: "Negligence", 
            def: "ä¸æ˜¯æ•…æ„çš„ï¼Œä½†å› ç‚ºå¤§æ„æˆ–ä¸å°å¿ƒè€ŒåšéŒ¯äº‹ã€‚" 
        },
        "æ•…æ„": { 
            pinyin: "gÃ¹ yÃ¬", 
            en: "Intentional", 
            def: "å¿ƒè£¡æ˜çŸ¥é“ä¸å°ï¼Œå»é‚„æ˜¯æƒ³å»åšé‚£ä»¶äº‹ã€‚" 
        },
        "è­°å®š": { 
            pinyin: "yÃ¬ dÃ¬ng", 
            en: "Agreed", 
            def: "å…©é‚Šçš„äººå•†é‡ï¼Œæœ€å¾Œå…±åŒæ±ºå®šçš„çµæœã€‚" 
        },
        "å±†æ»¿": { 
            pinyin: "jiÃ¨ mÇn", 
            en: "Expired", 
            def: "åŸæœ¬è¦å®šå¥½çš„æ™‚é–“å·²ç¶“çµæŸäº†ã€‚" 
        },
        "æ­§è¦–": { 
            pinyin: "qÃ­ shÃ¬", 
            en: "Discrimination", 
            def: "å› ç‚ºé•·ç›¸ã€åœ‹ç±çµ¦å°æ–¹ä¸å…¬å¹³å°å¾…ã€‚" 
        },
        "æ„æ€è¡¨ç¤º": { 
            pinyin: "yÃ¬ sÄ« biÇo shÃ¬", 
            en: "Will", 
            def: "æŠŠå¿ƒè£¡æƒ³çš„äº‹èªªå‡ºä¾†æˆ–å¯«å‡ºä¾†è®“åˆ¥äººçŸ¥é“ã€‚" 
        },
        "çµ¦ä»˜": { 
            pinyin: "jÇ fÃ¹", 
            en: "Payment", 
            def: "ç…§ç´„å®šæŠŠéŒ¢æˆ–å·¥ä½œçš„åŠ›æ°£äº¤çµ¦å°æ–¹ã€‚" 
        },
        "ä¾µæ¬Š": { 
            pinyin: "qÄ«n quÃ¡n", 
            en: "Infringement", 
            def: "äº‚ç”¨åˆ¥äººçš„æ¬Šåˆ©ï¼Œæˆ–è®“åˆ¥äººçš„èº«é«”ã€è²¡ç”¢å—å‚·ã€‚" 
        },
        "å‘Šè¨´ä¹ƒè«–": { 
            pinyin: "gÃ o sÃ¹ nÇi lÃ¹n", 
            en: "Complaint", 
            def: "é™¤éå—å®³äººã€Œä¸»å‹•å»å‘Šã€ï¼Œä¸ç„¶è­¦å¯Ÿä¸æœƒä¸»å‹•ç†ã€‚" 
        },
        "éºå¤±ç‰©": { 
            pinyin: "yÃ­ shÄ« wÃ¹", 
            en: "Lost Property", 
            def: "åˆ¥äººåœ¨è·¯ä¸Šå¼„ä¸Ÿçš„æ±è¥¿ã€‚" 
        },
        "å…¬ç„¶": { 
            pinyin: "gÅng rÃ¡n", 
            en: "Publicly", 
            def: "åœ¨å¾ˆå¤šäººéƒ½çœ‹å¾—åˆ°ã€è½å¾—åˆ°çš„åœ°æ–¹åšæŸäº‹ã€‚" 
        },
        "ä¾®è¾±": { 
            pinyin: "wÇ” rÇ”", 
            en: "Insult", 
            def: "èªªé›£è½è©±ç½µäººè®“å°æ–¹ä¸Ÿè‡‰ã€‚" 
        },
        "åŠæ‰£": { 
            pinyin: "diÃ o kÃ²u", 
            en: "Suspension", 
            def: "æ”¿åºœæš«æ™‚æ”¶èµ°ä½ çš„è­‰ç…§ï¼Œé€™æ®µæ™‚é–“ä¸èƒ½ç”¨ã€‚" 
        },
        "åŸºæœ¬å·¥è³‡": { 
            pinyin: "jÄ« bÄ›n gÅng zÄ«", 
            en: "Minimum Wage", 
            def: "æ³•å¾‹è¦å®šè€é—†æœ€å°‘ä¸€å®šè¦ç™¼çš„è–ªæ°´æ•¸ç›®ã€‚" 
        },
        "ä¾‹å‡": { 
            pinyin: "lÃ¬ jiÃ ", 
            en: "Regular Holiday", 
            def: "æ³•å¾‹è¦å®šä¸€é€±ä¸€å®šè¦ä¼‘æ¯çš„æ—¥å­ã€‚" 
        },
        "è¢«å®³äºº": { 
            pinyin: "bÃ¨i hÃ i rÃ©n", 
            en: "Victim", 
            def: "å—å‚·æˆ–æå¤±æ±è¥¿çš„é‚£å€‹äººã€‚" 
        },
        "ä¸»ç®¡æ©Ÿé—œ": { 
            pinyin: "zhÇ” guÇn jÄ« guÄn", 
            en: "Authorities", 
            def: "è² è²¬ç®¡é€™ä»¶äº‹çš„æ”¿åºœéƒ¨é–€ï¼ˆå¦‚å‹å‹•éƒ¨ï¼‰ã€‚" 
        }
    };

    // 20 æ¢å®Œæ•´æ³•è¦ï¼šåˆ†è¡Œæ’ç‰ˆ
    const studyData = [
        { 
            category: "å…¥å‡ºåœ‹åŠç§»æ°‘æ³•", 
            id: "imm_22", 
            name: "ç¬¬ 22 æ¢ (å…¥å¢ƒå¾Œå±…ç•™è­‰)", 
            intro: "å¦‚æœæˆ‘æƒ³é•·æ™‚é–“ç•™åœ¨å°ç£ï¼Œéœ€è¦è¾¦ä»€éº¼è­‰ä»¶ï¼Ÿ", 
            original: "1.å¤–åœ‹äººæŒæœ‰æ•ˆç°½è­‰æˆ–é©ç”¨ä»¥å…ç°½è­‰æ–¹å¼å…¥åœ‹ä¹‹æœ‰æ•ˆè­·ç…§æˆ–æ—…è¡Œè­‰ä»¶ï¼Œç¶“ç§»æ°‘ç½²æŸ¥é©—è¨±å¯å…¥åœ‹å¾Œï¼Œå–å¾—åœç•™ã€å±…ç•™è¨±å¯ã€‚\n\n2. ä¾å‰é …è¦å®šå–å¾—å±…ç•™è¨±å¯è€…ï¼Œæ‡‰æ–¼å…¥åœ‹å¾Œä¹‹ç¿Œæ—¥èµ·ç®—ä¸‰åæ—¥å…§ï¼Œå‘ç§»æ°‘ç½²ç”³è«‹å¤–åƒ‘å±…ç•™è­‰ã€‚ä½†ç”³è«‹å–å¾—å·¥ä½œè¨±å¯ã€å±…ç•™ç°½è­‰ã€å¤–åƒ‘å±…ç•™è­‰åŠé‡å…¥åœ‹è¨±å¯å››è­‰åˆä¸€ä¹‹æœ‰æ•ˆè­‰ä»¶ï¼Œæˆ–å…¶ä»–å·²å«æœ‰å¤–åƒ‘å±…ç•™è­‰åŠŸèƒ½ä¹‹è­‰ä»¶è€…ï¼Œå¾—å…ç”³è«‹å¤–åƒ‘å±…ç•™è­‰ã€‚\n\n3. å¤–åƒ‘å±…ç•™è­‰ä¹‹æœ‰æ•ˆæœŸé–“ï¼Œè‡ªè¨±å¯ä¹‹ç¿Œæ—¥èµ·ç®—ï¼Œæœ€é•·ä¸å¾—é€¾ä¸‰å¹´ã€‚", 
            levels: { 
                "B1-B2": { 
                    simplified: "å¦‚æœä½ æœ‰ç°½è­‰ï¼Œæˆ–æ˜¯å¯ä»¥ç”¨å…ç°½è­‰çš„æ–¹å¼ä¾†å°ç£ï¼Œåœ¨ç§»æ°‘ç½²åŒæ„å¾Œï¼Œä½ å°±å¯ä»¥åˆæ³•åœ°å…¥å¢ƒå°ç£ï¼Œä¹Ÿå¯ä»¥åœ¨å°ç£åœç•™æˆ–å±…ç•™ã€‚\n\nå¦‚æœä½ å·²ç¶“æœ‰å±…ç•™è³‡æ ¼ï¼Œä½ éœ€è¦åœ¨å…¥å¢ƒå¾Œä¸‰åå¤©å…§ï¼Œåˆ°ç§»æ°‘ç½²ç”³è«‹å¤–åƒ‘å±…ç•™è­‰ã€‚\n\nå¦‚æœä½ æƒ³è¦ç”³è«‹çš„è­‰ä»¶ä¹Ÿæœ‰å±…ç•™è­‰çš„åŠŸèƒ½ï¼Œä½ ä¸éœ€è¦å¦å¤–ç”³è«‹å¤–åƒ‘å±…ç•™è­‰ã€‚\n\nå¤–åƒ‘å±…ç•™è­‰æœ€å¤šå¯ä»¥ç”¨ä¸‰å¹´ã€‚", 
                    question: "å…¥å¢ƒå¾Œå¤šä¹…å…§è¦è¾¦å±…ç•™è­‰ï¼Ÿ", 
                    options: ["30å¤©å…§ã€‚", "90å¤©å…§ã€‚"], 
                    answer: 0, 
                    feedback: "æ³•å¾‹è¦å®šçš„æ™‚é–“æ˜¯30å¤©ä»¥å…§ã€‚" 
                },
                "C1-C2": { 
                    simplified: "å¤–åœ‹äººå–å¾—å±…ç•™è³‡æ ¼å¾Œï¼ŒåŸå‰‡ä¸Šæ‡‰æ–¼ä¸‰åæ—¥å…§ç”³è«‹å±…ç•™è­‰ã€‚\n\né è¨ˆç”³è«‹å››è­‰åˆä¸€ç­‰æœ‰æ•ˆè­‰ä»¶è€…ï¼Œå¾—å…æ–¼å¦å¤–é€²è¡Œç”³è«‹å¤–åƒ‘å±…ç•™è­‰çš„ç”³è«‹ã€‚\n\nå±…ç•™è­‰æœ‰æ•ˆæœŸé™ç‚ºä¸‰å¹´ã€‚", 
                    question: "ç”²æ˜¯ä¸€åå¤–åœ‹äººï¼ŒæŒæœ‰æ•ˆå±…ç•™ç°½è­‰å…¥å¢ƒå°ç£ï¼Œä¸¦ç¶“ç§»æ°‘ç½²æŸ¥é©—è¨±å¯å¾Œå–å¾—å±…ç•™è³‡æ ¼ã€‚å…¥å¢ƒå¾Œç¬¬äºŒåæ—¥ï¼Œç”²å°šæœªå‘ç§»æ°‘ç½²ç”³è«‹å¤–åƒ‘å±…ç•™è­‰ï¼Œä½†ç”²å·²æˆåŠŸå–å¾—ä¸€å¼µã€Œå››è­‰åˆä¸€ã€ä¹‹æœ‰æ•ˆè­‰ä»¶ï¼Œä¸”è©²è­‰ä»¶åŒ…å«å¤–åƒ‘å±…ç•™è­‰ä¹‹åŠŸèƒ½ã€‚\n\nä¾æœ¬æ¢è¦å®šï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ", 
                    options: ["ç”²æœªæ–¼å…¥å¢ƒå¾Œä¸‰åæ—¥å…§ç”³è«‹å¤–åƒ‘å±…ç•™è­‰ï¼Œå·²é•åè¦å®š", "ç”²å› å·²æŒæœ‰åŒ…å«å¤–åƒ‘å±…ç•™è­‰åŠŸèƒ½ä¹‹æœ‰æ•ˆè­‰ä»¶ï¼Œå¾—å…å†ç”³è«‹å¤–åƒ‘å±…ç•™è­‰"], 
                    answer: 1, 
                    feedback: "æœ¬æ¢è¦å®šï¼Œå–å¾—å±…ç•™è³‡æ ¼è€…ï¼ŒåŸå‰‡ä¸Šé ˆæ–¼å…¥å¢ƒç¿Œæ—¥èµ·ä¸‰åæ—¥å…§ç”³è«‹å¤–åƒ‘å±…ç•™è­‰ï¼›ç„¶è€Œï¼Œè‹¥ç•¶äº‹äººå·²å–å¾—åŒ…å«å¤–åƒ‘å±…ç•™è­‰åŠŸèƒ½ä¹‹æœ‰æ•ˆè­‰ä»¶ï¼Œå³å±¬ä¾‹å¤–æƒ…å½¢ï¼Œå¾—å…é‡è¤‡ç”³è«‹ã€‚å› æ­¤ï¼Œå³ä½¿å°šæœªå¦è¡Œç”³è«‹å¤–åƒ‘å±…ç•™è­‰ï¼Œäº¦ä¸æ§‹æˆé•åè¦å®šã€‚" 
                } 
            } 
        },
        { 
            category: "å‹å‹•åŸºæº–æ³•", 
            id: "lsa_21", 
            name: "ç¬¬ 21 æ¢ (æœ€ä½å·¥è³‡)", 
            intro: "æˆ‘çš„è€é—†è–ªæ°´ç™¼å¾—åˆæ³•å—ï¼Ÿ", 
            original: "å·¥è³‡ç”±å‹åƒ±é›™æ–¹è­°å®šä¹‹ã€‚ä½†ä¸å¾—ä½æ–¼åŸºæœ¬å·¥è³‡ã€‚", 
            penalties: [{ type: "money", label: "ç½°é°", value: "2è¬ ~ 100è¬" }], 
            levels: { 
                "B1-B2": { simplified: "è–ªè³‡ä¸å¾—ä½æ–¼åŸºæœ¬å·¥è³‡ã€‚", question: "é™åˆ¶ï¼Ÿ", options: ["ä¸å¾—ä½æ–¼åŸºæº–ã€‚", "éš¨æ„ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "å·¥è³‡å¼·è¡Œæ³•è¦ã€‚", question: "æ€§è³ªï¼Ÿ", options: ["å¼·è¡Œè¦å®šã€‚", "è‡ªç”±åˆæ„ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å‹å‹•åŸºæº–æ³•", 
            id: "lsa_24", 
            name: "ç¬¬ 24 æ¢ (åŠ ç­è²»)", 
            intro: "åŠ ç­ä»¥å¾Œï¼Œæˆ‘å¯ä»¥é ˜åˆ°å¤šå°‘éŒ¢ï¼Ÿ", 
            original: "é›‡ä¸»ä½¿å‹å·¥å»¶é•·å·¥ä½œæ™‚é–“è€…ï¼Œæ‡‰ä¾æ¨™æº–åŠ çµ¦å·¥è³‡ã€‚", 
            penalties: [{ type: "money", label: "ç½°é°", value: "2è¬ ~ 100è¬" }], 
            levels: { 
                "B1-B2": { simplified: "æ‡‰ä¾æ³•å®šåŠ æˆå€ç‡ç™¼æ”¾ã€‚", question: "æ¨™æº–ï¼Ÿ", options: ["åŠ æˆè¨ˆçµ¦ã€‚", "æ™‚è–ªç›¸åŒã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "å¡«è£œå‹å‹™è€—æè£œå„Ÿã€‚", question: "æ€§è³ªï¼Ÿ", options: ["æè€—å¡«è£œã€‚", "æ©æƒ ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å‹å‹•åŸºæº–æ³•", 
            id: "lsa_30", 
            name: "ç¬¬ 30 æ¢ (å·¥æ™‚ä¸Šé™)", 
            intro: "æˆ‘ä¸€å¤©æœ€å¤šèƒ½å·¥ä½œå¹¾å€‹å°æ™‚ï¼Ÿ", 
            original: "æ­£å¸¸å·¥æ™‚æ¯æ—¥ä¸è¶…é 8 å°æ™‚ï¼Œæ¯é€±ä¸è¶…é 40 å°æ™‚ã€‚", 
            penalties: [{ type: "money", label: "ç½°é°", value: "2è¬ ~ 100è¬" }], 
            levels: { 
                "B1-B2": { simplified: "æ¯æ—¥ 8 å°æ™‚ç‚ºé™ã€‚", question: "æ¯é€±ä¸Šé™ï¼Ÿ", options: ["40 å°æ™‚ã€‚", "48 å°æ™‚ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "ä¿è­·æ€§å¼·è¡Œè¦å®šã€‚", question: "æ³•å¾‹æ€§è³ªï¼Ÿ", options: ["å¼·è¡Œæ³•ã€‚", "ä»»æ„æ³•ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å‹å‹•åŸºæº–æ³•", 
            id: "lsa_36", 
            name: "ç¬¬ 36 æ¢ (ä¾‹å‡ä¼‘æ¯)", 
            intro: "å·¥ä½œå¤šä¹…ä»¥å¾Œå¯ä»¥ä¼‘æ¯ï¼Ÿ", 
            original: "å‹å·¥æ¯ä¸ƒæ—¥ä¸­æ‡‰æœ‰äºŒæ—¥ä¼‘æ¯ã€‚", 
            levels: { 
                "B1-B2": { simplified: "æ’å®šä¸€ä¾‹ä¸€ä¼‘ã€‚", question: "ä¾‹å‡åŠ ç­ï¼Ÿ", options: ["å¤©ç½æ‰è¡Œã€‚", "éš¨æ™‚ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "å¼·åˆ¶æ€§ä¼‘æ¯æ¬Šåˆ©ã€‚", question: "æ€§è³ªï¼Ÿ", options: ["ç”Ÿå­˜æ¬Šä¿éšœã€‚", "è¡Œæ”¿è£é‡ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å‹å‹•åŸºæº–æ³•", 
            id: "lsa_38", 
            name: "ç¬¬ 38 æ¢ (ç‰¹ä¼‘å‡)", 
            intro: "æˆ‘å·¥ä½œæ»¿åŠå¹´æœ‰ç‰¹ä¼‘å—ï¼Ÿ", 
            original: "å·¥ä½œæ»¿ä¸€å®šæœŸé–“ï¼Œæ‡‰çµ¦ç‰¹åˆ¥ä¼‘å‡ã€‚", 
            levels: { 
                "B1-B2": { simplified: "ä¾å¹´è³‡çµ¦æœ‰è–ªå‡ã€‚", question: "èª°æ’ï¼Ÿ", options: ["å‹å·¥ã€‚", "è€é—†ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "æ’å®šæ¬Šå±¬å‹å·¥ã€‚", question: "æœªä¼‘çµç®—ï¼Ÿ", options: ["ç™¼å·¥è³‡ã€‚", "è¦–æ”¾æ£„ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å°±æ¥­æœå‹™æ³•", 
            id: "esa_5", 
            name: "ç¬¬ 5 æ¢ (å¹³ç­‰å°±æ¥­)", 
            intro: "è€é—†å¯ä»¥å› ç‚ºæˆ‘çš„åœ‹ç±å°±ä¸è«‹æˆ‘å—ï¼Ÿ", 
            original: "ä¸å¾—ä»¥åœ‹ç±ã€å®—æ•™ã€æ€§åˆ¥äºˆä»¥æ­§è¦–ã€‚", 
            penalties: [{ type: "money", label: "ç½°é°", value: "30è¬ ~ 150è¬" }], 
            levels: { 
                "B1-B2": { simplified: "ç¦æ­¢å·®åˆ¥å¾…é‡ã€‚", question: "ç¯„åœï¼Ÿ", options: ["åœ‹ç±æ€§åˆ¥ã€‚", "å­¸æ­·ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "æ§‹æˆä¸æ³•æ­§è¦–ã€‚", question: "æœ€é«˜ç½°ï¼Ÿ", options: ["150è¬ã€‚", "1è¬ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å°±æ¥­æœå‹™æ³•", 
            id: "esa_43", 
            name: "ç¬¬ 43 æ¢ (å·¥ä½œè¨±å¯)", 
            intro: "æ²’è¨±å¯è­‰æˆ‘å¯ä»¥å·å·æ‰“å·¥å—ï¼Ÿ", 
            original: "å¤–åœ‹äººæœªç¶“è¨±å¯ï¼Œä¸å¾—å¾äº‹å·¥ä½œã€‚", 
            penalties: [{ type: "license", label: "è™•åˆ†", value: "é™ä»¤å‡ºåœ‹" }, { type: "money", label: "ç½°é°", value: "3è¬ ~ 15è¬" }], 
            levels: { 
                "B1-B2": { simplified: "é ˆå–å¾—è¨±å¯æ–¹å¾—å·¥ä½œã€‚", question: "éæ³•å¾Œæœï¼Ÿ", options: ["ç½°é°é£è¿”ã€‚", "è£œè¾¦ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "æ¡å¼·è¡Œè¨±å¯åˆ¶ã€‚", question: "æ©Ÿåˆ¶ï¼Ÿ", options: ["äº‹å‰è¨±å¯ã€‚", "å ±å‚™ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å°±æ¥­æœå‹™æ³•", 
            id: "esa_73", 
            name: "ç¬¬ 73 æ¢ (è¨±å¯å»¢æ­¢)", 
            intro: "æˆ‘çš„å·¥ä½œè­‰åœ¨ä»€éº¼æƒ…æ³æœƒå¤±æ•ˆï¼Ÿ", 
            original: "å¤–åœ‹äººé•æ³•åš´é‡ï¼Œæ‡‰å»¢æ­¢å…¶è¨±å¯ã€‚", 
            levels: { 
                "B1-B2": { simplified: "é•è¦ä¸»ç®¡æ©Ÿé—œæ’¤éŠ·è¨±å¯ã€‚", question: "ä¹‹å¾Œï¼Ÿ", options: ["é›¢å¢ƒã€‚", "æ›å·¥ä½œã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "ç¶­è­·å¸‚å ´ç§©åºã€‚", question: "å–®ä½ï¼Ÿ", options: ["å‹å‹•éƒ¨ã€‚", "å…§æ”¿éƒ¨ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å…¥å‡ºåœ‹åŠç§»æ°‘æ³•", 
            id: "imm_28", 
            name: "ç¬¬ 28 æ¢ (åœ°å€ç™»è¨˜)", 
            intro: "æ¬å®¶å¾Œè¦è·Ÿæ”¿åºœèªªæ–°åœ°å€å—ï¼Ÿ", 
            original: "å¤–åœ‹äººè®Šæ›´ä½å€æ‡‰ 15 æ—¥å…§ç™»è¨˜ã€‚", 
            penalties: [{ type: "money", label: "ç½°é°", value: "2åƒ ~ 1è¬" }], 
            levels: { 
                "B1-B2": { simplified: "15 æ—¥å…§ç”³å ±ã€‚", question: "æœŸé™ï¼Ÿ", options: ["15å¤©ã€‚", "30å¤©ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "å±…ä½åœ°ç”³å ±ç¾©å‹™ã€‚", question: "æ€§è³ªï¼Ÿ", options: ["è¡Œæ”¿ç½°ã€‚", "åˆ¤åˆ‘ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å…¥å‡ºåœ‹åŠç§»æ°‘æ³•", 
            id: "imm_31", 
            name: "ç¬¬ 31 æ¢ (å±…ç•™å»¶æœŸ)", 
            intro: "æˆ‘å¯ä»¥åœ¨å°ç£å¾…å¤šä¹…ï¼Ÿ", 
            original: "å±…ç•™å±†æ»¿å‰ï¼Œæ‡‰ç”³è«‹å»¶æœŸã€‚", 
            penalties: [{ type: "money", label: "ç½°é°", value: "2åƒ ~ 5è¬" }], 
            levels: { 
                "B1-B2": { simplified: "æ‡‰æ–¼å±†æ»¿å‰ç”³è«‹ã€‚", question: "å—ç†ï¼Ÿ", options: ["ç§»æ°‘ç½²ã€‚", "è­¦å¯Ÿã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "è¡Œæ”¿å”åŠ›ç¾©å‹™ã€‚", question: "æ€§è³ªï¼Ÿ", options: ["è¡Œæ”¿é•è¦ã€‚", "åˆ‘äº‹ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å…¥å‡ºåœ‹åŠç§»æ°‘æ³•", 
            id: "imm_36", 
            name: "ç¬¬ 36 æ¢ (å¼·åˆ¶é›¢å¢ƒ)", 
            intro: "åš´é‡é•æ³•æœƒè¢«è¶•å›åœ‹å—ï¼Ÿ", 
            original: "é•åè¦å®šæƒ…ç¯€åš´é‡ï¼Œå¾—å¼·åˆ¶é©…é€ã€‚", 
            penalties: [{ type: "license", label: "è™•åˆ†", value: "å¼·åˆ¶é›¢å¢ƒ" }], 
            levels: { 
                "B1-B2": { simplified: "å¼·åˆ¶é©…é€è™•åˆ†ã€‚", question: "å¼·åº¦ï¼Ÿ", options: ["å…·å¼·åˆ¶åŠ›ã€‚", "åƒè€ƒã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "é ˆç¬¦åˆæ­£ç•¶ç¨‹åºã€‚", question: "æ•‘æ¿Ÿï¼Ÿ", options: ["å¯è¨´é¡˜ã€‚", "ä¸èƒ½ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "å…¥å‡ºåœ‹åŠç§»æ°‘æ³•", 
            id: "imm_85", 
            name: "ç¬¬ 85 æ¢ (é€¾æœŸç½°å‰‡)", 
            intro: "é€¾æœŸäº†æœƒè¢«ç½°éŒ¢å—ï¼Ÿ", 
            original: "é€¾æœŸåœç•™è€…ï¼Œè™•ç½°é°ã€‚", 
            penalties: [{ type: "money", label: "ç½°é°", value: "2åƒ ~ 1è¬" }], 
            levels: { 
                "B1-B2": { simplified: "è¦–å¤©æ•¸è£ç½°ã€‚", question: "ç‰¹å¾µï¼Ÿ", options: ["å¤©æ•¸ç´¯è¨ˆã€‚", "å›ºå®šã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "å½±éŸ¿ç°½è­‰ã€‚", question: "å–®ä½ï¼Ÿ", options: ["ç§»æ°‘ç½²ã€‚", "æ³•é™¢ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "æ°‘äº‹æ³•å¾‹", 
            id: "civ_153", 
            name: "ç¬¬ 153 æ¢ (åˆç´„æˆç«‹)", 
            intro: "é»é ­å°±ç®—åˆç´„æˆç«‹å—ï¼Ÿ", 
            original: "ç•¶äº‹äººæ„æ€ä¸€è‡´ï¼Œå¥‘ç´„å³æˆç«‹ã€‚", 
            levels: { 
                "B1-B2": { simplified: "å…±è­˜å³ç”Ÿæ•ˆåŠ›ã€‚", question: "è¦ä»¶ï¼Ÿ", options: ["æ„æ€ä¸€è‡´ã€‚", "é ˆå…¬è­‰ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "æ„æ€ä¸€è‡´ç‚ºæ ¸å¿ƒã€‚", question: "æ€§è³ªï¼Ÿ", options: ["ä¸è¦å¼ã€‚", "è¦å¼ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "æ°‘äº‹æ³•å¾‹", 
            id: "civ_184", 
            name: "ç¬¬ 184 æ¢ (è³ å„Ÿè²¬ä»»)", 
            intro: "å¼„å£æ±è¥¿ä¸€å®šè¦è³ å—ï¼Ÿ", 
            original: "æ•…æ„éå¤±ä¾µå®³æ¬Šåˆ©ï¼Œè² è³ å„Ÿè²¬ä»»ã€‚", 
            penalties: [{ type: "money", label: "è³ å„Ÿ", value: "å¯¦éš›æå¤±" }], 
            levels: { 
                "B1-B2": { simplified: "è² å¡«è£œæå¤±ä¹‹è²¬ã€‚", question: "æ­¸è²¬ï¼Ÿ", options: ["æ•…æ„éå¤±ã€‚", "å‹•æ©Ÿã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "ä¸€èˆ¬ä¾µæ¬Šè²¬ä»»ã€‚", question: "ç¯„åœï¼Ÿ", options: ["æå¤±åˆ©å¾—ã€‚", "åƒ…ç¾é‡‘ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "æ°‘äº‹æ³•å¾‹", 
            id: "civ_421", 
            name: "ç¬¬ 421 æ¢ (ç§Ÿè³ƒå¥‘ç´„)", 
            intro: "ç§Ÿæˆ¿å­è¦æ³¨æ„ä»€éº¼ï¼Ÿ", 
            original: "ç‰©ç§Ÿèˆ‡ä»–æ–¹ï¼Œæ”¯ä»˜ç§Ÿé‡‘ä¹‹å¥‘ç´„ã€‚", 
            levels: { 
                "B1-B2": { simplified: "äº¤ä»˜ç‰©ï¼Œçµ¦å ±é…¬ã€‚", question: "ç¾©å‹™ï¼Ÿ", options: ["ä»˜ç§Ÿé‡‘ã€‚", "æ”¹æˆ¿ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "é›™å‹™æœ‰å„Ÿã€‚", question: "æ€§è³ªï¼Ÿ", options: ["é›™å‹™ã€‚", "å–®å‹™ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "åˆ‘äº‹æ³•å¾‹", 
            id: "crm_277", 
            name: "ç¬¬ 277 æ¢ (å‚·å®³ç½ª)", 
            intro: "æ‰“æ¶å—å‚·å¾Œæœå¤šåš´é‡ï¼Ÿ", 
            original: "å‚·å®³èº«é«”è€…ï¼Œè™•äº”å¹´ä»¥ä¸‹å¾’åˆ‘ã€‚", 
            penalties: [{ type: "jail", label: "å¾’åˆ‘", value: "5 å¹´ä»¥ä¸‹" }], 
            levels: { 
                "B1-B2": { simplified: "ä¾µå®³å¥åº·å¯å‘Šã€‚", question: "ç¯„åœï¼Ÿ", options: ["èº«é«”å¥åº·ã€‚", "æµè¡€ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "å‘Šè¨´ä¹ƒè«–ã€‚", question: "æ€§è³ªï¼Ÿ", options: ["å‘Šæ‰ç†ã€‚", "è­¦å¯Ÿç†ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "åˆ‘äº‹æ³•å¾‹", 
            id: "crm_309", 
            name: "ç¬¬ 309 æ¢ (å…¬ç„¶ä¾®è¾±)", 
            intro: "ç¶²è·¯ä¸Šç½µäººæœƒçŠ¯æ³•å—ï¼Ÿ", 
            original: "å…¬ç„¶ä¾®è¾±äººè€…ï¼Œè™•æ‹˜å½¹æˆ–ç½°é‡‘ã€‚", 
            penalties: [{ type: "money", label: "ç½°é‡‘", value: "9,000 ä»¥ä¸‹" }], 
            levels: { 
                "B1-B2": { simplified: "å…¬ç„¶ç‹€æ…‹ä¾®è¾±ä»–äººã€‚", question: "è¦ä»¶ï¼Ÿ", options: ["å…¬ç„¶æ€§ã€‚", "ç§ä¸‹ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "ç¬¦åˆå®¢è§€è¦ä»¶ã€‚", question: "ç§è¨Šç½µï¼Ÿ", options: ["ä¸å…·å…¬ç„¶ã€‚", "ç®—ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "åˆ‘äº‹æ³•å¾‹", 
            id: "crm_320", 
            name: "ç¬¬ 320 æ¢ (ç«Šç›œç½ª)", 
            intro: "æ²’åŒæ„æ‹¿æ±è¥¿ç®—å·å—ï¼Ÿ", 
            original: "æ„åœ–ä¸æ³•æ‰€æœ‰å–å‹•ç”¢ï¼Œç‚ºç«Šç›œã€‚", 
            penalties: [{ type: "jail", label: "å¾’åˆ‘", value: "5 å¹´ä»¥ä¸‹" }], 
            levels: { 
                "B1-B2": { simplified: "æ„åœ–ä½”æœ‰ä»–ç”¢ã€‚", question: "è¦ä»¶ï¼Ÿ", options: ["å–èµ°ã€‚", "ç¼ºéŒ¢ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "ä¾µå®³æ”¯é…æ¬Šã€‚", question: "æœªé‚ï¼Ÿ", options: ["ç½°ã€‚", "ä¸ç½°ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "åˆ‘äº‹æ³•å¾‹", 
            id: "crm_337", 
            name: "ç¬¬ 337 æ¢ (æ‹¾é‡‘ä¸æ˜§)", 
            intro: "æ’¿éŒ¢ä¸é‚„è­¦å¯ŸçŠ¯æ³•å—ï¼Ÿ", 
            original: "ä¾µå éºå¤±ç‰©ï¼Œè™•ç½°é‡‘ã€‚", 
            penalties: [{ type: "money", label: "ç½°é‡‘", value: "1.5 è¬ä»¥ä¸‹" }], 
            levels: { 
                "B1-B2": { simplified: "æ„åœ–ä½”æœ‰æ§‹æˆã€‚", question: "åšæ³•ï¼Ÿ", options: ["é€è­¦ã€‚", "ç•™è‘—ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "è™•ç½°é‡‘ã€‚", question: "è™•ç½°ï¼Ÿ", options: ["ç½°é‡‘ã€‚", "æ‹˜å½¹ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        },
        { 
            category: "äº¤é€šæ³•å¾‹", 
            id: "tra_35", 
            name: "ç¬¬ 35 æ¢ (é…’é§•é‡ç½°)", 
            intro: "å–é…’ä»¥å¾Œé–‹è»Šç½°å¤šå°‘ï¼Ÿ", 
            original: "é…’æ¸¬è¶…æ¨™è™•ä¸‰è¬è‡³åäºŒè¬ç½°é°ã€‚", 
            penalties: [{ type: "money", label: "ç½°é°", value: "3è¬ ~ 12è¬" }, { type: "license", label: "åŠæ‰£", value: "1 ~ 2 å¹´" }], 
            levels: { 
                "B1-B2": { simplified: "ç½°é°èˆ‡åŠæ‰£ã€‚", question: "å…§å®¹ï¼Ÿ", options: ["é‡‘éŒ¢è³‡æ ¼ã€‚", "è­¦å‘Šã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" }, 
                "C1-C2": { simplified: "å±éšªè¡Œæ”¿ç½°ã€‚", question: "æ€§è³ªï¼Ÿ", options: ["è¡Œæ”¿ç®¡åˆ¶ã€‚", "åˆ‘äº‹ã€‚"], answer: 0, feedback: "æ­£ç¢ºï¼" } 
            } 
        }
    ];

    function initSelectors() {
        const catSelector = document.getElementById('law-category-selector');
        if(!catSelector) return;
        const laws = [...new Set(studyData.map(item => item.category))];
        catSelector.innerHTML = laws.map(law => `<option value="${law}">${law}</option>`).join('');
        onCategoryChange();
    }

    function onCategoryChange() {
        const lawName = document.getElementById('law-category-selector').value;
        const artSelector = document.getElementById('article-selector');
        const filtered = studyData.filter(item => item.category === lawName);
        artSelector.innerHTML = filtered.map(art => `<option value="${art.id}">${art.name}</option>`).join('');
        updateContent();
    }

    function handleSearch() {
        const query = document.getElementById('article-search').value.trim().toLowerCase();
        const resultList = document.getElementById('search-results-list');
        if (!query) { resultList.style.display = 'none'; return; }
        const matches = studyData.filter(item => item.intro.toLowerCase().includes(query) || item.name.toLowerCase().includes(query));
        if (matches.length > 0) {
            resultList.innerHTML = matches.map(item => `<div class="search-item" onclick="selectFromSearch('${item.category}', '${item.id}')">ğŸ’¡ ${item.intro}</div>`).join('');
            resultList.style.display = 'block';
        } else {
            resultList.innerHTML = '<div class="search-item text-slate-400">æ‰¾ä¸åˆ°ç›¸ç¬¦æ³•è¦</div>';
            resultList.style.display = 'block';
        }
    }

    function handleGlossarySearch() {
        const query = document.getElementById('glossary-search').value.trim().toLowerCase();
        renderGlossaryTable(query);
    }

    function selectFromSearch(category, id) {
        const catEl = document.getElementById('law-category-selector');
        const artEl = document.getElementById('article-selector');
        if(catEl && artEl) {
            catEl.value = category;
            onCategoryChange();
            artEl.value = id;
            updateContent();
        }
        document.getElementById('article-search').value = "";
        document.getElementById('search-results-list').style.display = 'none';
        switchView('study');
    }

    function updateContent() {
        const artId = document.getElementById('article-selector').value;
        const item = studyData.find(d => d.id === artId);
        if(!item) return;
        const content = item.levels[currentLevel];
        
        const bSpan = document.getElementById('badge-text');
        const lBadge = document.getElementById('level-badge');
        if (bSpan) bSpan.innerText = `ç­‰ç´šï¼š${currentLevel}`;
        if (lBadge) lBadge.className = `badge-${currentLevel.toLowerCase()} shadow-lg`;

        document.getElementById('intro-box').innerText = `ğŸ’¡ ${item.intro}`;
        document.getElementById('law-original').innerHTML = highlightTerms(item.original);
        document.getElementById('law-simplified').innerHTML = highlightTerms(content.simplified);
        
        const grid = document.getElementById('penalty-grid');
        grid.innerHTML = (item.penalties || []).map(p => {
            let colorClass = 'tag-license'; let icon = 'ğŸ›¡ï¸'; let enLabel = '(Action)';
            if(p.type === 'money') { 
                colorClass = 'tag-money'; icon = 'ğŸ’°'; 
                enLabel = p.label.includes('ç½°é‡‘') ? '(Criminal Fine)' : '(Fine)';
            } else if(p.type === 'jail') { 
                colorClass = 'tag-jail'; icon = 'â›“ï¸'; enLabel = '(Imprisonment)'; 
            } else if(p.type === 'license') { 
                icon = (p.label.includes('é›¢å¢ƒ') || p.label.includes('å‡ºåœ‹')) ? 'âœˆï¸' : 'ğŸªª'; 
                enLabel = (p.label.includes('é›¢å¢ƒ')) ? '(Deport)' : '(Suspension)';
            }
            return `<div class="penalty-tag ${colorClass}"><span class="text-[14px] font-black opacity-80 mb-2 uppercase tracking-wide">${icon} ${p.label} <span class="text-[10px] font-bold opacity-60">${enLabel}</span></span><span class="text-2xl font-black tracking-tighter">${p.value}</span></div>`;
        }).join('') || '<p class="text-slate-400 font-black italic">æœ¬å–®å…ƒç„¡ç‰¹å®šç½°å‰‡</p>';
        
        document.getElementById('quiz-question').innerText = content.question;
        const container = document.getElementById('options-container');
        container.innerHTML = content.options.map((opt, idx) => `<div class="option-label" id="opt-label-${idx}" onclick="selectAnswer(${idx})">${opt}</div>`).join('');
        document.getElementById('feedback-box').style.display = 'none';
    }

    function selectAnswer(index) {
        const artId = document.getElementById('article-selector').value;
        const item = studyData.find(d => d.id === artId);
        const content = item.levels[currentLevel];
        const fb = document.getElementById('feedback-box');
        document.querySelectorAll('.option-label').forEach(el => el.classList.remove('selected-correct', 'selected-wrong'));
        const selectedLabel = document.getElementById(`opt-label-${index}`);
        fb.style.display = 'block';
        if (index === content.answer) {
            if(selectedLabel) selectedLabel.classList.add('selected-correct');
            fb.className = 'mt-8 p-8 rounded-3xl font-black text-xl text-left shadow-lg bg-emerald-100 text-emerald-800 border-2 border-emerald-500';
            fb.innerText = `âœ… æ­£ç¢ºï¼${content.feedback}`;
            startConfetti();
        } else {
            if(selectedLabel) selectedLabel.classList.add('selected-wrong');
            fb.className = 'mt-8 p-8 rounded-3xl font-black text-xl text-left shadow-lg bg-red-100 text-red-800 border-2 border-red-500';
            fb.innerText = `âŒ ç­”éŒ¯äº†ï¼è«‹é»æ“Šæ–‡ä¸­è—è‰²è©å½™å°‹æ‰¾ç·šç´¢ã€‚`;
        }
    }

    function switchView(viewName) {
        document.getElementById('view-study').classList.add('hidden');
        document.getElementById('view-glossary').classList.add('hidden');
        if (viewName === 'study') document.getElementById('view-study').classList.remove('hidden');
        else if (viewName === 'glossary') {
            document.getElementById('view-glossary').classList.remove('hidden');
            renderGlossaryTable();
        }
        window.scrollTo(0, 0);
    }

    function renderGlossaryTable(filterText = "") {
        const container = document.getElementById('glossary-table-content');
        const keys = Object.keys(globalGlossary).sort().filter(key => {
            const d = globalGlossary[key];
            return key.includes(filterText) || d.pinyin.toLowerCase().includes(filterText.toLowerCase()) || d.en.toLowerCase().includes(filterText.toLowerCase());
        });
        if (keys.length === 0) {
            container.innerHTML = '<p class="text-center text-slate-400 font-bold py-10">æ‰¾ä¸åˆ°ç›¸ç¬¦è©å½™</p>';
            return;
        }
        container.innerHTML = keys.map(key => {
            const d = globalGlossary[key];
            return `<div class="glossary-row shadow-sm"><div class="glossary-term-col"><span class="text-2xl font-black text-blue-900">${key}</span><span class="text-xs text-slate-400 font-bold mt-1 tracking-widest uppercase">${d.pinyin}</span></div><div class="flex items-center"><span class="text-[10px] font-black text-blue-600 bg-blue-50 px-3 py-1 rounded-full border border-blue-100 italic">${d.en}</span></div><div class="glossary-def-col">${d.def}</div></div>`;
        }).join('');
    }

    function highlightTerms(text) {
        if (!text) return "";
        const keys = Object.keys(globalGlossary).sort((a, b) => b.length - a.length);
        const pattern = new RegExp(keys.map(k => k.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|'), 'g');
        
        let colorCounter = 0;
        const colorClasses = ['word-color-0', 'word-color-1', 'word-color-2', 'word-color-3'];
        const seenInThisBlock = new Set(); // é—œéµï¼šè¨˜éŒ„æœ¬å€å¡Šå·²å‡ºç¾çš„è©å½™

        return text.replace(pattern, m => {
            // å¦‚æœé€™å€‹è©å·²ç¶“å‡ºç¾éï¼Œå°±å›å‚³åŸæ–‡å­— (ä¸åŠ æ¨™ç±¤)
            if (seenInThisBlock.has(m)) return m;
            
            // ç¬¬ä¸€æ¬¡å‡ºç¾ï¼Œè¨˜éŒ„ä¸‹ä¾†ä¸¦ä¸Šè‰²
            seenInThisBlock.add(m);
            const cls = colorClasses[colorCounter % colorClasses.length];
            colorCounter++;
            return `<span class="glossary-word ${cls}" onclick="openTermModal('${m}')">${m}</span>`;
        });
    }

    function openTermModal(key) {
        const d = globalGlossary[key];
        document.getElementById('modal-term').innerText = key;
        document.getElementById('modal-pinyin').innerText = d.pinyin;
        document.getElementById('modal-en').innerText = d.en; 
        document.getElementById('modal-def').innerText = d.def;
        document.getElementById('term-modal-overlay').classList.remove('hidden');
    }

    function closeTermModal() { document.getElementById('term-modal-overlay').classList.add('hidden'); }
    function openQuizModal() { document.getElementById('quiz-modal-overlay').classList.remove('hidden'); }
    function closeQuizModal() { document.getElementById('quiz-modal-overlay').classList.add('hidden'); }
    function openLevelModal() { document.getElementById('level-modal-overlay').classList.remove('hidden'); }
    function closeLevelModal() { document.getElementById('level-modal-overlay').classList.add('hidden'); }
    function openLogModal() { document.getElementById('log-modal-overlay').classList.remove('hidden'); }
    function closeLogModal() { document.getElementById('log-modal-overlay').classList.add('hidden'); }
    function openInfoModal() { document.getElementById('info-modal-overlay').classList.remove('hidden'); }
    function closeInfoModal() { document.getElementById('info-modal-overlay').classList.add('hidden'); }
    function changeLevel(l) { currentLevel = l; updateContent(); closeLevelModal(); }

    function startConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        if(!canvas) return;
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let p = [];
        for (let i = 0; i < 40; i++) p.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height - canvas.height, r: Math.random() * 4 + 2, d: Math.random() * 10, c: `hsl(${Math.random() * 360}, 100%, 50%)`, t: Math.random() * 10 - 10 });
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            p.forEach((p) => {
                ctx.beginPath(); ctx.lineWidth = p.r; ctx.strokeStyle = p.c;
                ctx.moveTo(p.x + p.t + p.r / 2, p.y); ctx.lineTo(p.x + p.t, p.y + p.t + p.r / 2); ctx.stroke();
                p.y += 3; if (p.y > canvas.height) p.y = -20;
            });
        }
        let anim = setInterval(draw, 20);
        setTimeout(() => { clearInterval(anim); ctx.clearRect(0, 0, canvas.width, canvas.height); }, 2500);
    }
    

	
    window.onscroll = function() {
        const header = document.getElementById('main-header');
        if (header && window.pageYOffset > 10) header.classList.add('scrolled');
        else if (header) header.classList.remove('scrolled');
    };

    window.onload = () => { initSelectors(); };
</script>

</body>
</html>
